  {% extends "base.html" %}
  {% block content %} 
  <script type="text/javascript" src="//cdnjs.cloudflare.com/ajax/libs/socket.io/0.9.16/socket.io.min.js"></script>
  <script>
    document.write('<style type="text/css">body{display:none}</style>');
    jQuery(function($){
      initShowCallsView();
    });
  </script>
  
  <div class='row' style='padding:20px 0px 30px 0px; text-align:center'>
    <h2>
      <span id='job-header' class='label label-primary'>
        <label id='job-status'>{{job.status.title().replace('-',' ')}}</label>
        <label id='job-summary'></label>
      </span>
    </h2>
      <p id='scheduled_datetime' style='display:none'>{{ job.fire_dtime }}</p>
  </div>
  
  <div class='data-container'>
    <div class='navbar-div'>
      <a class='hover' href="{{ url_for('index') }}">Jobs</a> / 
      {{ job.name }}
    </div>
    <table id='show-calls-table' class='table table-hover table-colored'>
      <thead>
        <tr>
          <!-- Imported Headers -->
          {% set col_num=1 %}
          {% for column in template %}
          <th style='text-align:center' id='col{{ col_num }}'>
            <a title='Sort' class='hover' href='#'>{{ column['field'].title().replace('_', ' ') }}</a>
          </th>
          {% set col_num = col_num + 1 %}
          {% endfor %}
          <!-- Status Headers -->
          {% set col_num = template|length+1 %}
          {% for column in template %}
            {% if 'status_field' in column %}
              <th style='text-align:center'  id='col{{col_num}}'>
                <a title='Sort' class='hover' href='#'>{{column['status_field'].title().replace('_', ' ')}}</a>
              </th>
            {% set col_num = col_num + 1 %}
            {% endif %}
          {% endfor %}
          <th class='cancel-call-col' style='width:50px'></th>
        </tr>
      </thead>
      <tbody style='WORD-BREAK:BREAK-ALL'>
        {% set row_num=1 %}
        {%  for call in calls %}
        <tr id='{{ call._id }}'>
          <!-- Imported Fields -->
          {% for column in template %}
            <td name='{{column.field}}'>{{call.imported[column.field]}}</td>
          {% endfor %}
          <!-- Status Fields -->
          {% if call.call_status == "completed" %}
            {% set tooltip = call.speak %}
            {% set label="label label-success" %}
            {% if call.answered_by == "machine" %}
              {% set caption="Sent Voicemail" %}
            {% else %}
              {% set caption="Sent Live" %}
            {% endif %}
          {% elif call.call_status == "pending" %}
            {% set label="label label-default" %}
            {% set caption="Pending" %}
          {% elif call.call_status == "failed" %}
            {% set label="label label-danger" %}
            {% set caption=call.error_msg.title().replace('_', ' ') %}
          {% else %}
            {% set label = "label label-primary" %}
            {% set caption = call.call_status.title() + ' (' ~ call.attempts + 'x)' %}
          {% endif %}
          <td title='"{{tooltip}}"'>
            {% set label="" %}
            <span style='text-align:right; font-size:14; font-weight:bold;' name='call_status_lbl' class='pull-right {{label}}'>{{caption}}</span>
          </td>
          
          {% for column in template %}
            {% if 'status_field' in column %}
              <!-- HACK. Fixme. -->
              {% if column["status_field"] == "email_status" %}
                {% if call["email_status"] == "delivered" %}
                  {% set caption = "Delivered" %}
                  {% set label = "label label-success" %}
                {% elif call["email_status"] == "dropped" %}
                  {% set caption = "Dropped" %}
                  {% set label = "label label-danger" %}
                {% elif call["email_status"] == "bounced" %}
                  {% set caption = "Bounced" %}
                  {% set label = "label label-danger" %}
                {% elif call["email_status"] == "pending" %}
                  {% set caption = "Pending" %}
                  {% set label = "label label-default" %}
                {% elif call["email_status"] == "no_email" %}
                  {% set caption = "No Email" %}
                  {% set label = "label label-default" %}
                {% else %}
                  {% set caption = call["email_status"].title() %}
                  {% set label = "label label-primary" %}
                {% endif %}
                 {% set label="" %} 
                <td>
                  <span style='text-align:right; font-size:14; font-weight:bold;' name='email_status_lbl' class='pull-right {{label}}'>{{caption}}</span>
                </td>
              {% endif %}
            {% endif %}
          {% endfor %}
          <td class='cancel-call-col'>
            <button 
              class='delete-btn' 
              type="button" 
              id="{{ call._id }}" 
              name="delete-btn">
            </button>
          </td>
        </tr>
        {% set row_num = row_num + 1 %}
        {% endfor %}
    </tbody>
    </table>
  </div>
  <div>
    <br><br>


    <a class='hover' id='execute-job' href="#">[Start Job]</a>
    <a class='hover' id='email-job' href="#">[Email Job]</a>
    <a class='hover' id='reset-job' href="#">[Reset Job]</a>
    <a class='hover' id='dump' href='#'>[DB Dump]</a>
  </div>
  {% endblock %}
