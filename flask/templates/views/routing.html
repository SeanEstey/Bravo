  {% extends "views/base.html" %}
  {% block content %}  
	<script type='text/javascript' 
					src="{{url_for('static', filename='js/base.js')}}">
	</script>
  <script>
    function toggleWarnings(event) {
          event.stopPropagation();
          var $target = $(event.target);
          if ( $target.closest("td").attr("colspan") > 1 ) {
              $target.slideUp();
          } else {
              $target.closest("tr").next().find("p").slideToggle();
          }                    
      }
    $(function() {
        $("td[colspan=12]").find("p").hide();
        $("td[name=warnings]").click(toggleWarnings);
    });
  </script>
  
  <div style='margin:40px 10px 40px 10px; text-align:center'>
    <h3 class='thin'>
    <script>
      var date = new Date();
      document.write('<b>' + date.toString('dddd, MMMM d, yyyy') + '</b>');
    </script>
    </h3>
  </div>
  <div id='status-banner' class='status-banner-div'>{{banner_msg}}</div>
  
  <div class='data-container'>
    <div class='navbar-div'>
			Routing
		</div>
    <table class='table table-hover table-colored'>
      <thead>
        <tr>
					<th>Date</th>
					<th>Block</th>
          <th>Orders</th>
          <th style='width:90px;'>Block Size</th>
          <th>Dropoffs</th>
					<th>Depot</td>
          <th>Driver</th>
					<th style='width:120px;'>Routing Status</th>
          <th style='width:130px'>Route Length</th>
          <th>Warnings</th>
          <th>Command</th>
          <th>Sheet</th>
        </tr>
      </thead>
      <tbody>
      {% for route in routes %}
        <tr>
          <td>{{ route.date.strftime("%A %b %d") }}</td>
          <td>{{ route.block }}</td>
          <td>{{ route.orders }}</td>
          <td>{{ route.block_size }}</td>
          <td>{{ route.dropoffs }}</td>
					<td>
            <select name='depots' class='form-control'>
              {% for depot in depots %}
              <option value='{{ depot.name }}'>{{ depot.name }}</option>
              {% endfor %}
            </select>
          </td>
          <td>
            <select name='drivers' class='form-control'>
              {% for driver in drivers %}
              <option value='{{ driver.name }}'>{{ driver.name }}</option>
              {% endfor %}
            </select>
          </td>
          <td>{{ route.status }}</td>
          <td>
            {% if route.duration is defined %}
              {{ (route.duration/60)|round(0,'floor')|int }} hrs {{ route.duration % 60 }} min
            {% else %}
              -- : --
            {% endif %}
          </td>
          <td name='warnings'>
            <a class='hover'
              onclick="toggleWarnings(event)">{{ route.geocode_warnings|length }}</a>
          </td>
          <td><a class='hover'
                 href="{{url_for('_build_route', route_id=route['_id'])
                 }}">Route</a>
          </td>
          <td>
            {% if route.ss_id is defined %}
              <a class='hover'
                 href="https://docs.google.com/spreadsheets/d/{{route.ss_id}}">View</a>
            {% endif %}
          </td>
        </tr>
        <tr><td style='padding:0;' colspan="12"><p style='padding:15px;'>
          {% if route.geocode_warnings is defined %}
            {% for warning in route.geocode_warnings %}
              {{ warning }} 
              <br><br>
            {% endfor %}
          {% endif %}
        </p></td></tr>
      {% endfor %}
      </tbody>
    </table>
    </div>
  </div>
  {% endblock %}


